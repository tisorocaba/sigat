var timeout,listaVerificada=!1;const url="https://sistemas.sorocaba.sp.gov.br/acesso_patrimonio/api/patrimonio/";var toggle=0,g_requer_patri=null,fila_atual=null,p_equips=[,];$(function(){painel(g_fila_usuario),$("#slctFila").val(g_fila_usuario),$("#btnAlteraPatrimonios").hide(),$("#divTabelaPatrimonios").hide(),$("#divTabelaChamadosAbertos").hide(),$("#divTabelaInserviveis").hide(),!0==listaVerificada&&$("#btnAbrirChamado").removeAttr("disabled"),$("input[name=id_usuario]").val(g_id_usuario),$("#tblEventos thead tr").clone(!0).appendTo("#tblEventos thead"),$("#tblEventos thead tr:eq(1) th").each(function(a){var e=$(this).text();$(this).html("<input type=\"text\" placeholder=\"Procurar "+e+"\" />"),$("input",this).on("keyup change",function(){$("#tblEventos").DataTable().column(a).search()!==this.value&&$("#tblEventos").DataTable().column(a).search(this.value).draw()})})});var enc=!1;function painel(a){$("#tblPainel").DataTable({autoWidth:!1,createdRow:function(a,e){"ABERTO"===e[5]&&$(a).addClass("table-warning"),"FECHADO"===e[5]&&$(a).addClass("table-success"),null===e[4]&&($(a).removeClass("table-warning"),$(a).addClass("table-danger"))},columnDefs:[{orderable:!1,targets:[6,7]}],language:{decimal:"",emptyTable:"Sem chamados :)",info:"Mostrando _START_ a _END_ de _TOTAL_ chamados",infoEmpty:"Mostrando 0 a 0 de 0 chamados",infoFiltered:"(filtrado de _MAX_ chamados)",infoPostFix:"",thousands:".",lengthMenu:"Mostrando _MENU_ chamados",loadingRecords:"Carregando...",processing:"Processando...",search:"Busca:",zeroRecords:"Sem resultados!",paginate:{first:"Primeiro",last:"\xDAltimo",next:"Pr\xF3ximo",previous:"Anterior"}},ajax:base_url+"chamado/listar_chamados_painel/"+a,order:[],drawCallback:function(){var a=null;$(".PopoverPainel").each(function(){a=$(this).attr("data-chamado"),$.ajax({type:"post",url:base_url+"backend/texto_ultima_interacao",data:{id_chamado:a},dataType:"json",success:a=>{$(this).popover({content:a.nome_usuario+a.texto_interacao,trigger:"focus",placement:"left",html:!0})}})})}})}function mudaFila(){!0==enc?$("#tblPainel").DataTable().ajax.url(base_url+"chamado/listar_encerrados_painel/"+$("#slctFila").val()).load():$("#tblPainel").DataTable().ajax.url(base_url+"chamado/listar_chamados_painel/"+$("#slctFila").val()).load()}setInterval(function(){$("#tblPainel").DataTable().ajax.reload(null,!1)},15e3);function painelEncerrados(a){!1==enc?($("#slctFila").val(0),$("#btnChamados").html("<i class=\"fas fa-binoculars\"></i> Chamados Abertos"),$("#tituloPainel").append(" (encerrados)"),$("#tblPainel").DataTable().ajax.url(base_url+"chamado/listar_encerrados_painel/"+a).load(),enc=!0):($("#slctFila").val(0),$("#btnChamados").html("<i class=\"fas fa-binoculars\"></i> Chamados Encerrados"),$("#tituloPainel").html("Painel de chamados"),$("#tblPainel").DataTable().ajax.url(base_url+"chamado/listar_chamados_painel/"+a).load(),enc=!1)}function buscaPatrimonios(a,e,t,o=!1,r=!1,s=!1){var n=[];$("#divPatrimonios").empty(),$("#btnRegistrarInteracao").removeAttr("disabled"),$.ajax({url:base_url+"backend/patrimonios",data:{id_chamado:a,espera:r},type:"POST",async:!0,dataType:"json",success:function(a){a.filas.forEach(function(o){(6!=o.id_fila||!0!=s)&&(6==e&&3!=o.id_fila||6!=e&&6==a.id_fila||(6==e&&$("select[name=id_fila]").append("<option value=\"6\" >Solicita\xE7\xE3o de Equipamento</option>"),$("select[name=id_fila]").append("<option value=\""+o.id_fila+"\" >"+o.nome_fila+"</option>"),!0==t?$("option[value="+a.id_fila+"]").prop("selected","true"):$("#slctFila option[value="+e+"]").remove()))}),null!=a.patrimonios&&6!=e&&a.patrimonios.forEach(function(a){n.push(a.num_patrimonio)});var d=0;$.ajax({type:"POST",async:!0,url:base_url+"backend/equipamentos",data:{id_chamado:g_id_chamado},dataType:"JSON",success:function(a){null!=a&&(d=1,p_equips=[,],a.equipamentos.forEach(function(a){p_equips.push([a.num_equipamento,a.desc_equipamento])}))},complete:function(){1<p_equips.length&&"ATENDIMENTO"==$("#slctTipo").val()&&($("#divPatrimonios").append("<p>Ser\xE3o considerados os seguintes equipamentos para esse atendimento:</p>"),$("#divPatrimonios").append("<ul></ul>"),p_equips.forEach(function(a){$("#divPatrimonios ul").append("<li>"+a[0]+" - "+a[1]+"</li>")}))}}),0<n.length?($("#divPatrimonios").empty(),!0==t?($("#divPatrimonios").prepend("<p>Marque os equipamentos que foram finalizados:</p>"),!o&&$("#divPatrimonios p").append(" <small><strong>(opcional)</strong></small>")):!1==r?$("#divPatrimonios").prepend("<p>Marque os equipamentos que ser\xE3o deixados em espera:</p>"):$("#divPatrimonios").prepend("<p>Marque os equipamentos que sair\xE3o da espera:</p>"),n.forEach(function(a){$("#divPatrimonios").append("<input class=\"chkPatri\" type=\"checkbox\" id=\""+a+"\" value=\""+a+"\"><label class=\"mr-2\" for=\""+a+"\">"+a+"</label>")})):!0==r?($("#divPatrimonios").prepend("<p>N\xE3o existem equipamentos em espera!</p>"),!s&&$("#btnRegistrarInteracao").prop("disabled","true")):6==e?($("#divPatrimonios").prepend("<p>Para este tipo de intera\xE7\xE3o, altere a fila para <b>Manuten\xE7\xE3o de Hardware</b></p>"),!s&&$("#btnRegistrarInteracao").prop("disabled","true")):0==d&&($("#divPatrimonios").prepend("<p>N\xE3o existem equipamentos dispon\xEDveis para isso!</p>"),!s&&$("#btnRegistrarInteracao").prop("disabled","true"))}})}function verificaTipo(a,e){switch($("select[name=id_fila]").empty(),$("#slctTipo").val()){case"ATENDIMENTO":!0==g_requer_patri?(buscaPatrimonios(e,a,!0,!1,!1),$("#divPatrimonios").show(),$("#divFila").show(),$("#slctFila").attr("disabled",!0)):($("#divPatrimonios").hide(),$("#divFila").hide(),$("#slctFila").attr("disabled",!0));break;case"ALT_FILA":buscaPatrimonios(e,a,!1,!1,!1,!0),$("#divFila").show(),$("#divPatrimonios").hide(),$("#slctFila").attr("disabled",!1);break;case"OBSERVACAO":$("#divPatrimonios").hide(),$("#divFila").hide(),$("#slctFila").attr("disabled",!0),$("#btnRegistrarInteracao").removeAttr("disabled");break;case"INSERVIVEL":3==a?(buscaPatrimonios(e,a,!0,!0),$("#divPatrimonios").show(),$("#divFila").show(),$("#slctFila").attr("disabled",!0)):($("#divPatrimonios").show(),$("#divPatrimonios").html("Op\xE7\xE3o dispon\xEDvel somente na fila <strong>Manuten\xE7\xE3o de Hardware</strong><br>"),$("#btnRegistrarInteracao").prop("disabled","true"),$("#divFila").hide());break;case"ESPERA":buscaPatrimonios(e,a,!1),$("#divPatrimonios").show(),$("#divFila").hide(),$("#slctFila").attr("disabled",!0);break;case"REM_ESPERA":buscaPatrimonios(e,a,!1,!1,!0),$("#divPatrimonios").show(),$("#divFila").hide(),$("#slctFila").attr("disabled",!0);break;case"FECHAMENTO":}}function criaFormRegistro(a,e){return"<div class=\"row\"><div class=\"col\"><label for=\"tipo\">Tipo</label><select class=\"form-control\" name=\"tipo\" id=\"slctTipo\" onchange=\"verificaTipo("+e+","+a+")\"></select></div></div><div class=\"row\" id=\"divFila\"><div class=\"col\"><label for=\"id_fila\">Fila</label><select class=\"form-control\" name=\"id_fila\" id=\"slctFila\"></select></div></div><div class=\"row mt-3\"><div class=\"col\"><div id=\"divPatrimonios\"></div></div></div><div class=\"row mb-3\"><div class=\"col\"><textarea name=\"txtInteracao\"></textarea></div></div><input type=\"hidden\" name=\"id_chamado\" value=\""+a+"\"/><input type=\"hidden\" name=\"id_fila_ant\" value=\""+e+"\"/>"}$("#modalRegistro").on("show.bs.modal",function(a){var e=$(a.relatedTarget),t=e.data("chamado"),o=$(this);$.ajax({url:base_url+"backend/requer_patrimonio",data:{id_fila:fila_atual},type:"GET",async:!1,success:function(a){"1"==a?(g_requer_patri=!0,o.find(".modal-body #conteudo_form").empty(),o.find(".modal-body #conteudo_form").prepend(criaFormRegistro(t,fila_atual))):(o.find(".modal-body #conteudo_form").empty(),o.find(".modal-body #conteudo_form").prepend(criaFormRegistro(t,fila_atual)))}})}),$("#modalRegistro").on("shown.bs.modal",function(){$("#btnRegistrarInteracao").removeAttr("disabled"),$("textarea[name=txtInteracao]").summernote({toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough","superscript","subscript"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]],["insert",["link","picture"]]],height:200,lang:"pt-BR",dialogsInBody:!0,disableDragAndDrop:!0}),$("#slctTipo").append("<option value=\"ATENDIMENTO\" selected>Atendimento</option><option value=\"OBSERVACAO\">Observa\xE7\xE3o</option><option value=\"ALT_FILA\">Altera\xE7\xE3o de fila</option>"),!0==g_requer_patri?($("#slctTipo").append("<option value=\"ESPERA\">Deixar em espera</option>"),$("#slctTipo").append("<option value=\"REM_ESPERA\">Remover da espera</option>"),$("#slctTipo").append("<option value=\"INSERVIVEL\">Classificar como inserv\xEDvel</option>")):$("#slctTipo").append("<option value=\"FECHAMENTO\">Finalizar</option>"),verificaTipo(fila_atual,g_id_chamado)}),$("#modalRegistro").on("hide.bs.modal",function(){$("div[role=alert]").remove()}),$("#modalRegistroEntrega").on("hide.bs.modal",function(){$(this).find("#btnRegistrarEntrega").hide()}),$("#modalRegistroEntrega").on("show.bs.modal",function(a){var e=$(a.relatedTarget),t=e.data("chamado");$(this).find(".modal-body form #conteudo_form_entrega").html("<label>A entrega foi realizada? </label><br><div class=\"custom-control custom-radio custom-control-inline\"><input onchange=\"verificaEntrega()\" type=\"radio\" value=\"1\" id=\"rdSim\" name=\"confirmaEntrega\" class=\"custom-control-input\"><label class=\"custom-control-label\" for=\"rdSim\">Sim</label></div><div class=\"custom-control custom-radio custom-control-inline\"><input onchange=\"verificaEntrega()\" type=\"radio\" value=\"0\" id=\"rdNao\" name=\"confirmaEntrega\" class=\"custom-control-input\"><label class=\"custom-control-label\" for=\"rdNao\">N\xE3o</label></div><div id=\"divFalhaEntrega\" style=\"display: none\"><div class=\"form-group\"><label for=\"txtFalhaEntrega\"><b>Descreva o motivo:</b></label><textarea class=\"form-control\" id=\"txtFalhaEntrega\" rows=\"3\"></textarea></div></div><div id=\"divEntrega\" style=\"display: none\"><div class=\"form-group\"><label for=\"termo\"><strong>Termo de entrega assinado</strong></label><input type=\"file\" class=\"form-control-file\" name=\"termo_entrega\" accept=\".pdf\"></div><div class=\"form-group\"><label for=\"termo\"><strong>Termo de responsabilidade assinado <small>(se houver)</small></strong></label><input type=\"file\" class=\"form-control-file\" name=\"termo_responsabilidade\" accept=\".pdf\"></div><div class=\"form-group\"><label for=\"nome_recebedor\"><strong>Nome do recebedor</strong></label><input type=\"text\" class=\"form-control\" name=\"nome_recebedor\"></div></div><input type=\"hidden\" name=\"id_chamado\" value=\""+t+"\" />")}),$("#modalEquipamentos").on("show.bs.modal",function(){$("#btnAdicionarEquipamentos").removeAttr("disabled")}),$("#modalEquipamentos").on("hidden.bs.modal",function(){$("tblEquipamentos tbody").empty(),listaVerificada=!1}),$("#modalEquipamentos").on("show.bs.modal",function(){listaVerificada=!1});let xhr;$("input[name=nome_solicitante]").autoComplete({source:function(a,e){try{xhr.abort()}catch(a){}xhr=$.getJSON(base_url+"backend/solicitantes",{q:a},function(a){e(a)})},minChars:2,autoFocus:!0}),$("input[name=nome_local]").autoComplete({source:function(a,e){try{xhr.abort()}catch(a){}xhr=$.getJSON(base_url+"backend/locais",{q:a},function(a){e(a)})},minChars:2});function precisaPatrimonio(a){$("#listaPatrimonios").hide(),$("#msg div[id=alerta]").remove(),$.get(base_url+"backend/requer_patrimonio",{id_fila:a},function(e){"1"==e?($("#listaPatrimonios").show(),$("#txtPatrimonios").removeAttr("readonly"),$("#btnVerificaPatrimonios").show(),$("#flagPrecisaPatrimonio").val(1),clearTimeout(timeout),$("#btnAbrirChamado").removeAttr("disabled"),listaVerificada=!1,6==a&&($("#divTabelaPatrimonios").hide(),$("#listaPatrimonios").hide(),listaVerificada=!0)):($("#divTabelaPatrimonios").hide(),$("#listaPatrimonios").hide(),$("#flagPrecisaPatrimonio").val(0))})}var vetorListaOK=[];async function criaTabelaPatrimonios(a,e){vetorListaOK=[];var t=[],o=[],r=[],s=[],n=[],d=[],l=[],m=[],p=[];$("[for=\"listaPatrimonios\"]").append("<div class=\"spinner-border spinner-border-sm\" role=\"status\">&nbsp;&nbsp;<span class=\"sr-only\">Carregando...</span></div>");for(var u of a)await fetch(base_url+"backend/patrimonio?url="+e+u+"&q="+u).then(a=>a.json()).then(a=>{null==a.descricao?t.push(u):(a.inservivel?(o.push(u),r.push(a.descricao),s.push(a.inservivel.id_chamado_patrimonio)):(n.push(u),d.push(a.descricao)),null!=a.chamado&&(l.push(u),m.push(a.descricao),p.push(a.chamado),n.pop(),d.pop()))});if(0<t.length)$("#listaVerificada div").remove(),$("[for=\"listaPatrimonios\"] .spinner-border").remove(),t.forEach(function(a){$("#msgPatr").append("<div class=\"alert alert-warning alert-dismissible fade show\" role=\"alert\">Patrim\xF4nio inv\xE1lido: <strong>"+a+"</strong><button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button></div>")}),$("#txtPatrimonios").removeAttr("readonly"),$("#txtPatrimonios").show(),$("#txtPatrimonios").focus(),$("#btnAlteraPatrimonios").hide(),$("#btnVerificaPatrimonios").show(),$("#divTabelaPatrimonios").hide();else{if($("[for=\"listaPatrimonios\"] .spinner-border").remove(),0<o.length){$("#divTabelaInserviveis").show();for(var c=0;c<o.length;c++)$("#tblInserviveis tbody").append("<tr class=\"table-danger\"><td>"+o[c]+"</td><td>"+r[c]+"</td><td>#"+s[c]+" <a target=\"_blank\" href=\""+base_url+"chamado/"+s[c]+"\">Mais...</a></td></tr>");listaVerificada=!1,$("#btnRemovePatrimonios").show()}if(0<l.length){$("#divTabelaChamadosAbertos").show();for(var c=0;c<l.length;c++)$("#tblPatrimoniosAbertos tbody").append("<tr class=\"table-warning\"><td>"+l[c]+"</td><td>"+m[c]+"</td><td>#"+p[c]+" <a target=\"_blank\" href=\""+base_url+"chamado/"+p[c]+"\"><small>Mais...</small></a></td></tr>");listaVerificada=!1,$("#btnRemovePatrimonios").show()}if(0<n.length){$("#divTabelaPatrimonios").show(),$("#btnAlteraPatrimonios").show();for(var c=0;c<n.length;c++)$("#tblPatrimonios tbody").append("<tr><td>"+n[c]+"</td><td>"+d[c]+"</td></tr>"),vetorListaOK.push(n[c]);0==l.length&&(listaVerificada=!0)}}}$("#btnVerificaPatrimonios").click(function(){var a=$("#txtPatrimonios").val(),e=a.match(/[1-9]\d{5}/g);if(null!=e){for($("#msgPatr div[role=alert]").remove(),$("#txtPatrimonios").prop("readonly","true"),$("#tblPatrimonios tbody tr").remove(),$("#tblPatrimoniosAbertos tbody tr").remove(),$("#btnVerificaPatrimonios").hide(),duplicado=!1,i=0;i<e.length-1;i++)for(x=e[i],j=i+1;j<e.length;j++)if(x==e[j]){duplicado=!0;break}!0==duplicado?($("#listaVerificada div").remove(),$("[for=\"listaPatrimonios\"] .spinner-border").remove(),$("#msgPatr").append("<div class=\"alert alert-warning alert-dismissible fade show\" role=\"alert\">Existem patrim\xF4nios duplicados na lista!<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button></div>"),$("#txtPatrimonios").removeAttr("readonly"),$("#txtPatrimonios").focus(),$("#btnAlteraPatrimonios").hide(),$("#btnVerificaPatrimonios").show(),$("#divTabelaPatrimonios").hide()):criaTabelaPatrimonios(e,url)}}),$("#btnRemovePatrimonios").click(function(){$("#tblPatrimoniosAbertos tbody tr").remove(),$("#divTabelaChamadosAbertos").hide(),$("#tblInserviveis tbody tr").remove(),$("#divTabelaInserviveis").hide(),$("#btnRemovePatrimonios").hide(),listaVerificada=!0,$("#txtPatrimonios").val(vetorListaOK),""==$("#txtPatrimonios").val()&&($("#txtPatrimonios").removeAttr("readonly"),$("#txtPatrimonios").focus(),$("#btnVerificaPatrimonios").show()),vetorListaOK=[]}),$("#btnAlteraPatrimonios").click(function(){$("#tblPatrimonios tbody tr").remove(),$("#tblPatrimoniosAbertos tbody tr").remove(),$("#btnVerificaPatrimonios").show(),$("#btnAlteraPatrimonios").hide(),$("#txtPatrimonios").removeAttr("readonly"),$("#txtPatrimonios").focus(),$("#divTabelaPatrimonios").hide(),$("#divTabelaChamadosAbertos").hide(),listaVerificada=!1});var tem_anexo=0;$("#chkAnexo").on("click",function(){0==tem_anexo?($("#divAnexo").append("<input type=\"file\" class=\"form-control-file\" accept=\".gif,.jpg,.png,.pdf,.doc,.docx,.xls,.xlsx,.odt,.ods,.jpeg,.txt\" name=\"anexo\">"),$("#chkAnexo").val(1),tem_anexo=1):($("#divAnexo input[name=anexo]").remove(),$("#chkAnexo").val(0),tem_anexo=0)}),$("#frmAbrirChamado").on("submit",function(a){a.preventDefault()}).validate({rules:{nome_solicitante:"required",nome_local:"required",telefone:{required:!0,digits:!0,minlength:3},listaPatrimonios:{required:function(){return!(1!=$("#flagPrecisaPatrimonio").val()||6==$("#id_fila").val())},minlength:6,maxlength:2e3},descricao:{required:!0,maxlength:2e3,minlength:10,normalizer:function(a){return $.trim(a)}}},messages:{nome_solicitante:"Campo obrigat\xF3rio!",nome_local:"Campo obrigat\xF3rio!",telefone:{required:"Campo obrigat\xF3rio!",digits:"Somente d\xEDgitos (0-9)!",minlength:"M\xEDnimo 3 d\xEDgitos!"},descricao:{required:"Campo obrigat\xF3rio!",minlength:"Descri\xE7\xE3o insuficiente!",maxlength:"Tamanha m\xE1ximo excedido!"},listaPatrimonios:{required:"Campo obrigat\xF3rio!",minlength:"Informe pelo menos 1 patrim\xF4nio!",maxlength:"Tamanha m\xE1ximo excedido!"}},submitHandler:function(a){var e=base_url+"chamado/registrar_chamado",t=new FormData(a);return $.ajax({url:e,type:"POST",data:t,contentType:!1,cache:!1,processData:!1,beforeSend:function(){return!1==listaVerificada&&1==$("#flagPrecisaPatrimonio").val()?($("#msg div[id=alerta]").remove(),$("#msg").append("<div id=\"alerta\" class=\"alert alert-warning alert-dismissible\">"),$("#alerta").append("<a href=\"#\" class=\"close\" data-dismiss=\"alert\" aria-label=\"close\">&times;</a>\xC9 necess\xE1rio verificar a lista de patrim\xF4nios!"),$("#btnVerificaPatrimonios").focus(),targetOffset=$("#msg").offset().top,$("html, body").animate({scrollTop:targetOffset-100},200),!1):void $("#btnAbrirChamado").prop("disabled","true")},success:function(e){$("#msg div[id=alerta]").remove(),$("#msg").append(e),listaVerificada=!1,!1==e.includes("anexo")&&!1==e.includes("Local")?$(a).trigger("reset"):(e.includes("Local")&&$("input[name=nome_local").focus(),e.includes("anexo")&&$("input[name=anexo").focus(),listaVerificada=!0,$("#btnAbrirChamado").removeAttr("disabled")),0==$("#flagPrecisaPatrimonio").val()?timeout=setTimeout(function(){$("#btnAbrirChamado").removeAttr("disabled")},1e4):($("#btnAbrirChamado").removeAttr("disabled"),!1==listaVerificada&&($("#tblPatrimonios tr").remove(),$("#btnVerificaPatrimonios").show(),$("#btnAlteraPatrimonios").hide(),$("#txtPatrimonios").removeAttr("readonly"),$("#txtPatrimonios").focus(),$("#divTabelaPatrimonios").hide())),targetOffset=$("#msg").offset().top,$("html, body").animate({scrollTop:targetOffset-100},200),e=null},error:function(a,e,t){$("#msg").prepend("<div id=\"alerta\" class=\"alert alert-danger alert-dismissible\">"),$("#alerta").append("<a href=\"#\" class=\"close\" data-dismiss=\"alert\" aria-label=\"close\">&times;</a>"+t),targetOffset=$("#msg").offset().top,$("html, body").animate({scrollTop:targetOffset-100},200),$("#btnAbrirChamado").removeAttr("disabled")}}),!1}});function carregaChamado(a,e){document.title="Chamado #"+a+" - Sigat";var t=null;$("#botoesAtendimento #btnModalRegistroEntrega").remove(),$("#botoesAtendimento #baixarTermoEntrega").remove(),$("#botoesAtendimento #baixarTermoResp").remove(),$("#botoesAtendimento #baixarLaudoIns").remove(),$("#botoesAtendimento #btnModalRegistro").remove(),$("#botoesAtendimento #btnEncerrarChamado").remove(),$("#botoesAtendimento #btnModalEquipamentos").remove(),$("#botoesChamado hr").hide(),$.ajax({url:base_url+"backend/chamado",dataType:"json",async:!0,data:{id_chamado:a},success:function(o){$("input[name=fila]").val(o.nome_fila_chamado),$("input[name=data_chamado]").val(o.data_chamado),$("input[name=status]").val(o.status_chamado),$("input[name=nome_solicitante]").val(o.nome_solicitante_chamado),$("input[name=telefone]").val(o.telefone_chamado),$("input[name=nome_local]").val(o.nome_local),$("input[name=id_fila_ant]").val(o.id_fila),$("textarea[name=descricao]").val(o.descricao_chamado),null==o.id_responsavel?$("select[name=id_responsavel]").empty():(t=o.id_responsavel,$("select[name=id_responsavel]").html("<option value=\""+o.id_responsavel+"\">"+o.nome_responsavel+"</option>")),fila_atual=o.id_fila;var r=o.entrega_chamado,s=o.status_chamado;6==o.id_fila&&(!$("#botoesAtendimento #btnModalEquipamentos").length&&o.id_responsavel==g_id_usuario&&$("#botoesAtendimento").prepend("<button type=\"button\" id=\"btnModalEquipamentos\" class=\"btn btn-primary\" data-toggle=\"modal\" data-target=\"#modalEquipamentos\" data-chamado=\""+a+"\"><i class=\"fas fa-plus-square\"></i> Adicionar Equipamentos</button> "),!$("#botoesAtendimento #btnModalRegistro").length&&o.id_responsavel==g_id_usuario&&$("#botoesAtendimento").append("<button type=\"button\" id=\"btnModalRegistro\" class=\"btn btn-primary\" data-toggle=\"modal\" data-target=\"#modalRegistro\" data-chamado=\""+a+"\"><i class=\"far fa-file-alt\"></i> Nova Intera\xE7\xE3o</button> ")),0<o.equipamentos.length&&(6==o.id_fila||3==o.id_fila)?($("#tblEquipamentosChamado tbody").html(""),o.equipamentos.forEach(function(a){$("#tblEquipamentosChamado tbody").append("<tr><td>"+a.num_equipamento+"</td><td>"+a.desc_equipamento+"</td><td>"+a.status_equipamento+"</td></tr>")}),!$("#botoesAtendimento #btnModalRegistro").length&&o.id_responsavel==g_id_usuario&&$("#botoesAtendimento").append("<button type=\"button\" id=\"btnModalRegistro\" class=\"btn btn-primary\" data-toggle=\"modal\" data-target=\"#modalRegistro\" data-chamado=\""+a+"\"><i class=\"far fa-file-alt\"></i> Nova Intera\xE7\xE3o</button> ")):$("#listaEquipamentosChamado").hide(),!0!=e&&1==o.requer_patrimonio_fila?($("#tblPatrimonios tbody").html(""),o.patrimonios.forEach(function(e){$.ajax({url:base_url+"backend/patrimonio?url="+url+e.num_patrimonio+"&q="+e.num_patrimonio,dataType:"json",async:!0,success:function(o){var n=null;n="FALHA"==e.status_patrimonio_chamado?"ABERTO":e.status_patrimonio_chamado,$("#tblPatrimonios tbody").append("<tr><td>"+e.num_patrimonio+"</td><td>"+o.descricao+"</td><td>"+n+"</td></tr>"),("ENTREGA"==e.status_patrimonio_chamado||1==r)&&"ABERTO"==s&&($("#botoesAtendimento #btnModalRegistroEntrega").remove(),$("#botoesAtendimento #baixarTermoEntrega").remove(),$("#botoesAtendimento #baixarTermoResp").remove(),$("#botoesAtendimento").append("<button type=\"button\" id=\"btnModalRegistroEntrega\" class=\"btn btn-success\" data-toggle=\"modal\" data-chamado=\""+a+"\" data-target=\"#modalRegistroEntrega\"><i class=\"fas fa-file-signature\"></i> Registrar entrega</button> <a href=\""+base_url+"chamado/gerar_termo/"+a+"\" id=\"baixarTermoEntrega\" role=\"button\" class=\"btn btn-info\"><i class=\"fas fa-file-download\"></i> Baixar Termo de Entrega</a> <a href=\""+base_url+"chamado/gerar_termo_resp/"+ +a+"\" id=\"baixarTermoResp\" role=\"button\" class=\"btn btn-info\"><i class=\"fas fa-file-download\"></i> Baixar Termo de Responsabilidade</a>")),"ABERTO"!=e.status_patrimonio_chamado&&"ESPERA"!=e.status_patrimonio_chamado&&"FALHA"!=e.status_patrimonio_chamado||t!=g_id_usuario||$("#botoesAtendimento #btnModalRegistro").length||$("#botoesAtendimento").prepend("<button type=\"button\" id=\"btnModalRegistro\" class=\"btn btn-primary\" data-toggle=\"modal\" data-target=\"#modalRegistro\" data-chamado=\""+a+"\"><i class=\"far fa-file-alt\"></i> Nova Intera\xE7\xE3o</button> ")}})})):!$("#botoesAtendimento #btnModalRegistro").length&&o.id_responsavel==g_id_usuario&&$("#botoesAtendimento").append("<button type=\"button\" id=\"btnModalRegistro\" class=\"btn btn-primary\" data-toggle=\"modal\" data-target=\"#modalRegistro\" data-chamado=\""+a+"\"><i class=\"far fa-file-alt\"></i> Nova Intera\xE7\xE3o</button> "),"ABERTO"!=o.status_chamado&&($("#botoesAtendimento #btnModalRegistro").remove(),$("#botoesAtendimento #btnModalEquipamentos").remove());4==g_auto_usuario&&"FECHADO"==o.status_chamado&&($("#btnEncerrarChamado").length||$("#botoesAtendimento").prepend("<button id=\"btnEncerrarChamado\" onclick=\"encerrarChamado()\" class=\"btn btn-success\"><i class=\"far fa-check-circle\"></i> Encerrar chamado</button>"));"ABERTO"==o.status_chamado?((3<=g_auto_usuario&&null!=o.id_responsavel||o.id_responsavel==g_id_usuario)&&($("#btnDesbloquearChamado").show(),$("#btnEditarChamado").show(),$("#botoesChamado hr").show()),null==o.id_responsavel&&3<=g_auto_usuario&&($("#btnEditarChamado").show(),$("#btnDesbloquearChamado").hide(),$("#botoesChamado hr").show()),null==o.id_responsavel&&2>=g_auto_usuario&&($("#btnBloquearChamado").show(),$("#btnEditarChamado").hide(),$("#btnDesbloquearChamado").hide(),$("#botoesChamado hr").show()),null==o.id_responsavel&&3<=g_auto_usuario&&($("#btnBloquearChamado").show(),$("#btnEditarChamado").show(),$("#btnDesbloquearChamado").hide(),$("#botoesChamado hr").show()),null!=o.id_responsavel&&3<=g_auto_usuario&&($("#btnBloquearChamado").hide(),$("#btnEditarChamado").show(),$("#btnDesbloquearChamado").show(),$("#botoesChamado hr").show()),g_id_usuario==o.id_responsavel&&2>=g_auto_usuario&&($("#btnBloquearChamado").hide(),$("#btnEditarChamado").show())):($("#btnEditarChamado").hide(),$("#btnDesbloquearChamado").hide(),$("#botoesChamado hr").hide())}})}function removeInteracao(a,e){var t=!1;$.ajax({url:base_url+"interacao/remover_interacao",type:"POST",data:{id_interacao:a},beforeSend:function(){if($("#btnDesfazer").prop("disabled","true"),$.ajax({url:base_url+"backend/interacao",type:"GET",dataType:"text",async:!1,data:{id_chamado:g_id_chamado,id_usuario:g_id_usuario,id_interacao:a},success:function(a){"1"===a&&(t=!0)}}),t)return $("#btnDesfazer").removeAttr("disabled"),alert("Opera\xE7\xE3o n\xE3o permitida!"),!1},success:function(){atualizaInteracoes(e),carregaChamado(e)}})}$("#frmInteracao").on("submit",function(a){a.preventDefault();var e=base_url+"chamado/registrar_interacao",t=$("textarea[name=txtInteracao]").summernote("code"),o=$("input[name=id_chamado]").val(),r=$("input[name=id_fila_ant]").val(),s=$("select[name=tipo]").val(),n=$("select[name=id_fila]").val(),d=[];return $("input[class=chkPatri]").each(function(){$(this).is(":checked")&&d.push($(this).val())}),$.ajax({url:e,type:"POST",data:{txtInteracao:t,id_chamado:o,tipo:s,id_fila:n,id_fila_ant:r,patrimonios_atendidos:d,equipamentos_atendidos:p_equips,id_usuario:g_id_usuario},beforeSend:function(){return 0==d.length&&3==r&&"INSERVIVEL"==s||0==d.length&&("REM_ESPERA"==s||"ESPERA"==s)?($("#modalRegistro .modal-body").prepend("<div class=\"alert alert-warning fade show\" role=\"alert\">Selecione os equipamentos!<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button></div>"),!1):$("textarea[name=txtInteracao]").summernote("isEmpty")?($("#modalRegistro .modal-body").prepend("<div class=\"alert alert-warning fade show\" role=\"alert\">O texto n\xE3o pode ficar em branco!<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button></div>"),!1):void $("#btnRegistrarInteracao").prop("disabled","true")},success:function(){$("#btnRegistrarInteracao").removeAttr("disabled"),atualizaInteracoes(o),$("textarea[name=txtInteracao]").summernote("reset"),$("#modalRegistro").modal("hide"),carregaChamado(o),p_equips=[,]},error:function(a,e,t){alert(a+t),$("#btnRegistrarInteracao").removeAttr("disabled")}}),!1});function atualizaInteracoes(a){$.post(base_url+"backend/interacoes",{id:a}).done(function(a){$("#interacoes").html(a)})}function verificaEntrega(){1==$("input[name=confirmaEntrega]:checked").val()?($("#divEntrega").show(),$("#divFalhaEntrega").hide(),$("#btnRegistrarEntrega").show(),$("#btnRegistrarEntrega span").html(" Registrar entrega")):($("#divEntrega").hide(),$("#divFalhaEntrega").show(),$("#btnRegistrarEntrega").show(),$("#btnRegistrarEntrega span").html(" Registrar falha de entrega"),$("#txtFalhaEntrega").summernote({toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough","superscript","subscript"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]]],height:200,lang:"pt-BR",dialogsInBody:!0,disableDragAndDrop:!0}))}$("#frmRegistroEntrega").on("submit",function(a){a.preventDefault();const e=base_url+"interacao/registrar_entrega",t=base_url+"interacao/registrar_falha_entrega";var o=$(this)[0],r=$("input[name=id_chamado]").val(),s=$("input[name=confirmaEntrega]:checked").val();if(1==s)$.ajax({url:e,type:"POST",data:new FormData(o),contentType:!1,processData:!1,beforeSend:function(){return""==$("input[name=termo]").val()?($("#divEntrega").prepend("<div class=\"alert alert-warning fade show\" role=\"alert\">Est\xE1 faltando o termo!<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button></div>"),$("input[name=termo]").focus(),!1):""==$("input[name=nome_recebedor]").val()?($("#divEntrega").prepend("<div class=\"alert alert-warning fade show\" role=\"alert\">Informe o nome do recebedor!<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button></div>"),$("input[name=nome_recebedor]").focus(),!1):void $("#btnRegistrarEntrega").prop("disabled","true")},success:function(a){a.includes("ok")?(atualizaInteracoes(r),$("#modalRegistroEntrega").modal("hide"),carregaChamado(r),$("#btnRegistrarEntrega").removeAttr("disabled")):($("#divEntrega").prepend("<div class=\"alert alert-warning fade show\" role=\"alert\"><button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>"+a+"</div>"),$("#btnRegistrarEntrega").removeAttr("disabled"))}});else{var n=$("#txtFalhaEntrega").summernote("code");$.ajax({url:t,type:"POST",data:{descr_falha:n,id_chamado:r},beforeSend:function(){return $("#txtFalhaEntrega").summernote("isEmpty")?($("#divFalhaEntrega").prepend("<div class=\"alert alert-warning fade show\" role=\"alert\">Preencha a descri\xE7\xE3o!<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button></div>"),!1):void $("#btnRegistrarEntrega").prop("disabled","true")},success:function(){atualizaInteracoes(r),$("#modalRegistroEntrega").modal("hide"),carregaChamado(r),$("#btnRegistrarEntrega").removeAttr("disabled")},error:function(){atualizaInteracoes(r),$("#modalRegistroEntrega").modal("hide"),carregaChamado(r),$("#btnRegistrarEntrega").removeAttr("disabled")}})}});function encerrarChamado(){var a=$("#btnEncerrarChamado");4==g_auto_usuario&&confirm("Deseja realmente encerrar? Isso n\xE3o poder\xE1 ser desfeito!")&&$.ajax({type:"post",url:base_url+"chamado/encerrar_chamado",data:{id_chamado:g_id_chamado,id_usuario:g_id_usuario},beforeSend:function(){a.prop("disabled","true")},success:function(e){0!=e&&(a.removeAttr("disabled"),atualizaInteracoes(g_id_chamado),carregaChamado(g_id_chamado,!0))}})}var bloqueado=!1;$("#btnBloquearChamado").on("click",function(a){a.preventDefault(),$.ajax({type:"POST",url:base_url+"backend/atualiza_responsavel",data:{id_chamado:g_id_chamado,id_usuario:g_id_usuario,tipo:"b"},beforeSend:function(){$("#btnBloquearChamado").prop("disabled","true"),$.ajax({type:"GET",async:!0,url:base_url+"backend/chamado",data:{id_chamado:g_id_chamado},dataType:"JSON",complete:function(a){null!=a.id_responsavel&&($("#btnBloquearChamado").removeAttr("disabled"),$("#btnBloquearChamado").hide(),alert("Chamado j\xE1 est\xE1 bloqueado por "+a.nome_responsavel),carregaChamado(g_id_chamado,!0),bloqueado=!0)}})},success:function(){$("#btnBloquearChamado").removeAttr("disabled"),carregaChamado(g_id_chamado,!0)}})}),$("#btnDesbloquearChamado").on("click",function(a){a.preventDefault(),$.ajax({type:"POST",url:base_url+"backend/atualiza_responsavel",data:{id_chamado:g_id_chamado,id_usuario:g_id_usuario,tipo:"d"},beforeSend:function(){$("#btnDesbloquearChamado").prop("disabled","true")},success:function(a){0==a?($("#btnDesbloquearChamado").removeAttr("disabled"),$("#btnDesbloquearChamado").hide(),carregaChamado(g_id_chamado,!0)):alert("Opera\xE7\xE3o n\xE3o permitida: o chamado est\xE1 fechado!")}})}),$("#btnEditarChamado").on("click",function(a){a.preventDefault(),$("#btnBloquearChamado").hide(),$("#btnDesbloquearChamado").hide(),$("#btnEditarChamado").hide(),$.ajax({url:base_url+"backend/chamado",dataType:"json",data:{id_chamado:g_id_chamado},success:function(a){3<=g_auto_usuario&&($("#frmEditarChamado select[name=id_responsavel]").removeAttr("disabled"),$("#frmEditarChamado select[name=id_responsavel]").html(""),$.ajax({url:base_url+"backend/usuarios",dataType:"json",type:"post",success:function(a){$("#frmEditarChamado select[name=id_responsavel]").append("<option></option>"),a.forEach(function(a){$("#frmEditarChamado select[name=id_responsavel]").append("<option value=\""+a.id_usuario+"\">"+a.nome_usuario+"</option>")})}})),a.id_responsavel==g_id_usuario||3<=g_auto_usuario?($("#frmEditarChamado input[name=nome_solicitante]").removeAttr("disabled"),$("#frmEditarChamado input[name=telefone]").removeAttr("disabled"),$("#frmEditarChamado input[name=nome_local]").removeAttr("disabled"),$("#frmEditarChamado button[type=submit]").removeAttr("hidden"),$("#frmEditarChamado button[type=submit]").removeAttr("disabled"),$("#frmEditarChamado #btnCancelarEdicao").removeAttr("hidden")):(alert("Chamado bloqueado!"),$("#btnEditarChamado").show())}})}),$("#btnCancelarEdicao").on("click",function(a){carregaChamado(g_id_chamado,!0),a.preventDefault(),$("#frmEditarChamado input[name=nome_solicitante]").prop("disabled","true"),$("#frmEditarChamado input[name=telefone]").prop("disabled","true"),$("#frmEditarChamado input[name=nome_local]").prop("disabled","true"),$("#frmEditarChamado button[type=submit]").prop("hidden","true"),$("#frmEditarChamado select[name=id_responsavel]").attr("disabled","true"),$("#frmEditarChamado #btnEditarChamado").show(),$(this).prop("hidden","true")}),$("#frmEditarChamado").on("submit",function(a){a.preventDefault()}).validate({rules:{nome_solicitante:"required",nome_local:"required",telefone:{required:!0,digits:!0,minlength:3}},messages:{nome_solicitante:"Campo obrigat\xF3rio!",nome_local:"Campo obrigat\xF3rio!",telefone:{required:"Campo obrigat\xF3rio!",digits:"Somente d\xEDgitos (0-9)!",minlength:"M\xEDnimo 3 d\xEDgitos!"}},submitHandler:function(a){var e=base_url+"chamado/alterar_chamado",t=new FormData(a);$.ajax({url:e,type:"POST",data:t,contentType:!1,cache:!1,processData:!1,beforeSend:function(){var a=!1;if($("#frmEditarChamado input[type=submit]").prop("disabled","true"),$.ajax({url:base_url+"backend/chamado",dataType:"json",data:{id_chamado:g_id_chamado},success:function(e){(e.status_chamado="FECHADO")&&(a=!0)}}),a)return alert("Opera\xE7\xE3o n\xE3o permitida: chamado fechado!"),!1},success:function(a){carregaChamado(g_id_chamado,!0),atualizaInteracoes(g_id_chamado),$("#frmEditarChamado #alerta").prepend(a),setTimeout(function(){$("#msg_sucesso").alert("close")},2500),$("#frmEditarChamado input[name=nome_solicitante]").prop("disabled","true"),$("#frmEditarChamado select[name=id_responsavel]").prop("disabled","true"),$("#frmEditarChamado input[name=telefone]").prop("disabled","true"),$("#frmEditarChamado input[name=nome_local]").prop("disabled","true"),$("#frmEditarChamado button[type=submit]").prop("hidden","true"),$("#frmEditarChamado #btnEditarChamado").show(),$("#frmEditarChamado #btnCancelarEdicao").prop("hidden","true")},error:function(a,e,t){alert(t)}})}});async function criaTabelaPatrimoniosEquip(a,e){vetorListaOK=[];var t=[],o=[],r=[],s=[],n=[],d=[],l=[],m=[],p=[];$("[for=\"listaPatrimoniosEquip\"]").append("<div class=\"spinner-border spinner-border-sm\" role=\"status\">&nbsp;&nbsp;<span class=\"sr-only\">Carregando...</span></div>");for(var u of a)await fetch(base_url+"backend/patrimonio?url="+e+u+"&q="+u).then(a=>a.json()).then(a=>{null==a.descricao?t.push(u):(a.inservivel?(o.push(u),r.push(a.descricao),s.push(a.inservivel.id_chamado_patrimonio)):(n.push(u),d.push(a.descricao)),null!=a.chamado&&(l.push(u),m.push(a.descricao),p.push(a.chamado),n.pop(),d.pop()))});if(0<t.length)$("#listaVerificadaEquip div").remove(),$("[for=\"listaPatrimoniosEquip\"] .spinner-border").remove(),t.forEach(function(a){$("#msgPatrEquip").append("<div class=\"alert alert-warning alert-dismissible fade show\" role=\"alert\">Patrim\xF4nio inv\xE1lido: <strong>"+a+"</strong><button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button></div>")}),$("#txtPatrimoniosEquip").removeAttr("readonly"),$("#txtPatrimoniosEquip").show(),$("#txtPatrimoniosEquip").focus(),$("#btnAlteraPatrimoniosEquip").hide(),$("#btnVerificaPatrimoniosEquip").show(),$("#divTabelaPatrimoniosEquip").hide();else{if($("[for=\"listaPatrimoniosEquip\"] .spinner-border").remove(),0<o.length){$("#divTabelaInserviveisEquip").show();for(var c=0;c<o.length;c++)$("#tblInserviveisEquip tbody").append("<tr class=\"table-danger\"><td>"+o[c]+"</td><td>"+r[c]+"</td><td>#"+s[c]+" <a target=\"_blank\" href=\""+base_url+"chamado/"+s[c]+"\">Mais...</a></td></tr>");listaVerificada=!1,$("#btnRemovePatrimoniosEquip").show()}if(0<l.length){$("#divTabelaChamadosAbertosEquip").show();for(var c=0;c<l.length;c++)$("#tblEquipAbertos tbody").append("<tr class=\"table-warning\"><td>"+l[c]+"</td><td>"+m[c]+"</td><td>#"+p[c]+" <a target=\"_blank\" href=\""+base_url+"chamado/"+p[c]+"\"><small>Mais...</small></a></td></tr>");listaVerificada=!1,$("#btnRemovePatrimoniosEquip").show()}if(0<n.length){$("#divTabelaPatrimoniosEquip").show(),$("#btnAlteraPatrimoniosEquip").show();for(var c=0;c<n.length;c++)$("#tblPatrimoniosEquip tbody").append("<tr><td>"+n[c]+"</td><td>"+d[c]+"</td></tr>"),vetorListaOK.push(n[c]);0==l.length&&(listaVerificada=!0)}}}$("#btnVerificaPatrimoniosEquip").click(function(){var a=$("#txtPatrimoniosEquip").val(),e=a.match(/[1-9]\d{5}/g);if(null!=e){for($("#msgPatrEquip div[role=alert]").remove(),$("#txtPatrimoniosEquip").prop("readonly","true"),$("#tblPatrimoniosEquip tbody tr").remove(),$("#tblEquipAbertos tbody tr").remove(),$("#tblInserviveisEquip tbody tr").remove(),$("#btnVerificaPatrimoniosEquip").hide(),duplicado=!1,i=0;i<e.length-1;i++)for(x=e[i],j=i+1;j<e.length;j++)if(x==e[j]){duplicado=!0;break}!0==duplicado?($("[for=\"listaPatrimoniosEquip\"] .spinner-border").remove(),$("#msgPatrEquip").append("<div class=\"alert alert-warning alert-dismissible fade show\" role=\"alert\">Existem patrim\xF4nios duplicados na lista!<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button></div>"),$("#txtPatrimoniosEquip").removeAttr("readonly"),$("#txtPatrimoniosEquip").focus(),$("#btnAlteraPatrimoniosEquip").hide(),$("#btnVerificaPatrimoniosEquip").show(),$("#divTabelaPatrimoniosEquip").hide()):criaTabelaPatrimoniosEquip(e,url)}}),$("#btnRemovePatrimoniosEquip").click(function(){$("#tblPatrimoniosAbertosEquip tbody tr").remove(),$("#divTabelaChamadosAbertosEquip").hide(),$("#tblInserviveisEquip tbody tr").remove(),$("#divTabelaInserviveisEquip").hide(),$("#btnRemovePatrimoniosEquip").hide(),$("#txtPatrimoniosEquip").val(vetorListaOK),""==$("#txtPatrimoniosEquip").val()&&($("#txtPatrimoniosEquip").removeAttr("readonly"),$("#txtPatrimoniosEquip").focus(),$("#btnVerificaPatrimoniosEquip").show()),vetorListaOK=[]}),$("#btnAlteraPatrimoniosEquip").click(function(){$("#tblEquipamentos tbody tr").remove(),$("#tblPatrimoniosAbertosEquip tbody tr").remove(),$("#btnVerificaPatrimoniosEquip").show(),$("#btnAlteraPatrimoniosEquip").hide(),$("#txtPatrimoniosEquip").removeAttr("readonly"),$("#txtPatrimoniosEquip").focus(),$("#divTabelaPatrimoniosEquip").hide(),$("#divTabelaChamadosAbertosEquip").hide(),listaVerificada=!1});var vEquip=[[,]];function zeraEquipamentos(){vEquip=[[,]]}$("#btnAdcEquip").on("click",function(){$("#msgEquip div[id=alerta]").remove(),""!=$("#txtNumSerieEquip").val()&&""!=$("#txtDescEquip").val()&&(vEquip.push([$("#txtNumSerieEquip").val(),$("#txtDescEquip").val().toUpperCase()]),$("#tblEquipamentos tbody").append("<tr><td>"+$("#txtNumSerieEquip").val()+"</td><td>"+$("#txtDescEquip").val().toUpperCase()+"</td></tr>"),$("#txtNumSerieEquip").val(""),$("#txtDescEquip").val(""))}),$("#btnLimpaEquip").on("click",function(){$("#msgEquip div[id=alerta]").remove(),$("#tblEquipamentos tbody").empty(),zeraEquipamentos()}),$("#frmEquipamentos").on("submit",function(a){a.preventDefault();var e=new FormData($("#frmEquipamentos")[0]);if(0<vEquip.length){var t=JSON.stringify(vEquip);e.append("json_equip",t)}$.ajax({url:base_url+"interacao/adicionar_equipamentos",type:"POST",data:e,contentType:!1,cache:!1,processData:!1,beforeSend:function(){return $("#btnAdicionarEquipamentos").attr("disabled","true"),!1==listaVerificada&&$("#chkEquipamentos").is(":unchecked")?($("#btnAdicionarEquipamentos").removeAttr("disabled"),$("#msgPatrEquip div[id=alerta]").remove(),$("#msgPatrEquip").append("<div id=\"alerta\" class=\"alert alert-warning alert-dismissible\">"),$("#alerta").append("<a href=\"#\" class=\"close\" data-dismiss=\"alert\" aria-label=\"close\">&times;</a>\xC9 necess\xE1rio verificar a lista de patrim\xF4nios!"),$("#btnVerificaPatrimoniosEquip").focus(),$("#btnAdicionarEquipamentos").removeAttr("disabled"),!1):$("#chkEquipamentos").is(":checked")&&0==vEquip.length?($("#msgEquip div[id=alerta]").remove(),$("#msgEquip").append("<div id=\"alerta\" class=\"alert alert-warning alert-dismissible\">"),$("#alerta").append("<a href=\"#\" class=\"close\" data-dismiss=\"alert\" aria-label=\"close\">&times;</a>Adicione pelo menos 1 equipamento!"),$("#btnAdicionarEquipamentos").removeAttr("disabled"),!1):void 0},success:function(){$("#modalEquipamentos").modal("hide"),zeraEquipamentos(),atualizaInteracoes(g_id_chamado),carregaChamado(g_id_chamado),listaVerificada=!1,$("#btnAdicionarEquipamentos").removeAttr("disabled"),$("#frmEquipamentos").trigger("reset"),$("#tblEquipamentos tbody").empty(),$("#txtPatrimoniosEquip").removeAttr("readonly"),$("#txtPatrimoniosEquip").focus(),$("#btnAlteraPatrimoniosEquip").hide(),$("#btnVerificaPatrimoniosEquip").show(),$("#divTabelaPatrimoniosEquip").hide(),$("#listaEquipamentos").hide()},complete:function(){}})});var autorizacoes=[{Name:"T\xE9cnico",Id:"2"},{Name:"Administrador",Id:"3"},{Name:"Master",Id:"4"}],estados=[{Name:"ATIVO",Id:"ATIVO"},{Name:"INATIVO",Id:"INATIVO"}],opcoes_fila=[{Name:"SIM",Id:"1"},{Name:"N\xC3O",Id:"0"}],filas=[{id_fila:"0",nome_fila:"Todos"}];$.ajax({url:base_url+"backend/filas",dataType:"json",complete:a=>{Array.prototype.push.apply(filas,a.responseJSON),$("#usuarios-grid").jsGrid({fields:[{name:"nome_usuario",type:"text",validate:"required",title:"Nome"},{name:"login_usuario",type:"text",validate:"required",title:"Login"},{name:"data_usuario",type:"text",readOnly:!0,title:"Data de cria\xE7\xE3o"},{name:"status_usuario",type:"select",items:estados,textField:"Name",valueField:"Id",title:"Situa\xE7\xE3o"},{name:"autorizacao_usuario",type:"select",items:autorizacoes,textField:"Name",valueField:"Id",title:"Autoriza\xE7\xE3o"},{name:"fila_usuario",type:"select",items:filas,textField:"nome_fila",valueField:"id_fila",title:"Fila preferencial"},{name:"alteracao_usuario",type:"text",readOnly:!0,title:"\xDAltima altera\xE7\xE3o"},{type:"control",deleteButton:!1}]})}}),$("#usuarios-grid").jsGrid({width:"100%",height:"auto",autoload:!0,inserting:!0,editing:!0,sorting:!0,paging:!0,filtering:!1,loadMessage:"Carregando...",noDataContent:"(vazio)",controller:{loadData:function(){return $.ajax({url:base_url+"usuario/listar_usuarios",dataType:"json"})},updateItem:function(a){return $.ajax({type:"POST",url:base_url+"usuario/atualizar_usuario",data:a,dataType:"json"})},insertItem:function(a){return $.ajax({type:"POST",url:base_url+"usuario/inserir_usuario",data:a,dataType:"json"})}},fields:[{name:"nome_usuario",type:"text",validate:"required",title:"Nome"},{name:"login_usuario",type:"text",validate:"required",title:"Login"},{name:"data_usuario",type:"text",readOnly:!0,title:"Data de cria\xE7\xE3o"},{name:"status_usuario",type:"select",items:estados,textField:"Name",valueField:"Id",title:"Situa\xE7\xE3o"},{name:"autorizacao_usuario",type:"select",items:autorizacoes,textField:"Name",valueField:"Id",title:"Autoriza\xE7\xE3o"},{name:"alteracao_usuario",type:"text",readOnly:!0,title:"\xDAltima altera\xE7\xE3o"},{type:"control",deleteButton:!1}]}),$("#filas-grid").jsGrid({width:"100%",height:"auto",autoload:!0,inserting:!1,editing:!1,sorting:!0,paging:!0,filtering:!1,loadMessage:"Carregando...",noDataContent:"(vazio)",controller:{loadData:function(){return $.ajax({url:base_url+"admin/listar_filas/1",dataType:"json"})},updateItem:function(a){return $.ajax({type:"POST",url:base_url+"admin/atualizar_fila",data:a,dataType:"json"})},insertItem:function(a){return $.ajax({type:"POST",url:base_url+"admin/inserir_fila",data:a,dataType:"json"})}},fields:[{name:"nome_fila",type:"text",validate:"required",title:"Nome"},{name:"status_fila",type:"select",items:estados,textField:"Name",valueField:"Id",title:"Situa\xE7\xE3o"},{name:"requer_patrimonio_fila",type:"select",items:opcoes_fila,textField:"Name",valueField:"Id",title:"Requer patrim\xF4nio?"}]}),$("#filas-avulsas-grid").jsGrid({width:"100%",height:"auto",autoload:!0,inserting:!0,editing:!0,sorting:!0,paging:!0,filtering:!1,loadMessage:"Carregando...",noDataContent:"(vazio)",controller:{loadData:function(){return $.ajax({url:base_url+"admin/listar_filas/0",dataType:"json"})},updateItem:function(a){return $.ajax({type:"POST",url:base_url+"admin/atualizar_fila",data:a,dataType:"json"})},insertItem:function(a){return $.ajax({type:"POST",url:base_url+"admin/inserir_fila",data:a,dataType:"json"})}},fields:[{name:"nome_fila",type:"text",validate:"required",title:"Nome"},{name:"status_fila",type:"select",items:estados,textField:"Name",valueField:"Id",title:"Situa\xE7\xE3o"},{name:"requer_patrimonio_fila",type:"select",items:opcoes_fila,textField:"Name",valueField:"Id",title:"Requer patrim\xF4nio?"},{type:"control",deleteButton:!1}]}),$("#tblEventos").DataTable({autoWidth:!0,columnDefs:[{width:"10%",targets:3},{width:"10%",targets:0},{width:"40%",targets:2}],orderCellsTop:!0,fixedHeader:!0,language:{decimal:"",emptyTable:"(vazio)",info:"Mostrando _START_ a _END_ de _TOTAL_ eventos",infoEmpty:"Mostrando 0 a 0 de 0 eventos",infoFiltered:"(filtrado de _MAX_ eventos)",infoPostFix:"",thousands:".",lengthMenu:"Mostrando _MENU_ eventos",loadingRecords:"Carregando...",processing:"Processando...",search:"Busca:",zeroRecords:"Sem resultados!",paginate:{first:"Primeiro",last:"\xDAltimo",next:"Pr\xF3ximo",previous:"Anterior"}},ajax:base_url+"admin/listar_eventos/",order:[[3,"desc"]]}),setInterval(function(){$("#tblEventos").DataTable().ajax.reload(null,!1)},15e3);